/**
* PersonaProviderImpl.java
* appEducacionalVaadin
* 10/1/2015 19:07:02
* Copyright David
* com.app.presenter.data
*/
package com.app.presenter.data;

import java.io.ByteArrayOutputStream;
import java.io.InputStream;
import java.io.OutputStream;

import com.app.domain.model.types.Persona;
import com.vaadin.navigator.View;
import com.vaadin.server.Resource;
import com.vaadin.server.StreamResource;
import com.vaadin.ui.Component;
import com.vaadin.ui.Image;
import com.vaadin.ui.ProgressBar;
import com.vaadin.ui.Upload.StartedEvent;
import com.vaadin.ui.VerticalLayout;
import com.vaadin.ui.Upload.SucceededEvent;

/**
 * @author David
 *
 */
public class PersonaProviderImpl implements PersonaProvider{

	
	public ByteArrayOutputStream outputStream;
	
	public byte[] file;
	
	public VerticalLayout viewContainerUpload;
	
	ProgressBar progressBar;
	
	public PersonaProviderImpl(VerticalLayout imageContainer){
		this.viewContainerUpload = imageContainer;
		progressBar = new ProgressBar();
	}
	
	/**
	 * 
	 */
	private static final long serialVersionUID = 6110406325173825411L;

	/* (non-Javadoc)
	 * @see com.vaadin.ui.Upload.Receiver#receiveUpload(java.lang.String, java.lang.String)
	 */
	@Override
	public OutputStream receiveUpload(String filename, String mimeType) {
		outputStream = new ByteArrayOutputStream();
		return outputStream;
	}

	/* (non-Javadoc)
	 * @see com.app.presenter.data.PersonaProvider#getPersona()
	 */
	@Override
	public Persona getPersona() {
		return null;
	}

	/* (non-Javadoc)
	 * @see com.vaadin.ui.Upload.ProgressListener#updateProgress(long, long)
	 */
	@Override
	public void updateProgress(long readBytes, long contentLength) {
		progressBar.setValue(new Float(readBytes / (float) contentLength));
	}

	/* (non-Javadoc)
	 * @see com.vaadin.ui.Upload.SucceededListener#uploadSucceeded(com.vaadin.ui.Upload.SucceededEvent)
	 */
	@Override
	public void uploadSucceeded(SucceededEvent event) {
		file = outputStream.toByteArray();
		Image image = (Image) viewContainerUpload.getComponent(0);
		Resource resource = new StreamResource(streamSource, filename)
		image.setSource(resource);
	}

	/* (non-Javadoc)
	 * @see com.vaadin.ui.Upload.StartedListener#uploadStarted(com.vaadin.ui.Upload.StartedEvent)
	 */
	@Override
	public void uploadStarted(StartedEvent event) {
		viewContainerUpload.addComponent(progressBar);
		progressBar.setValue(0f);
		progressBar.setVisible(true);
	}

	/* (non-Javadoc)
	 * @see com.vaadin.server.StreamResource.StreamSource#getStream()
	 */
	@Override
	public InputStream getStream() {
		return null;
	}

}
